#!/bin/bash

# å¿«é€Ÿåˆ›å»ºæ¯æ—¥å­¦ä¹ ç¬”è®°è„šæœ¬
# ç”¨æ³•: ./create-daily-note.sh [æ—¥æœŸ]
# ä¸å¸¦å‚æ•°æ—¶è‡ªåŠ¨ä½¿ç”¨ä»Šå¤©æ—¥æœŸ

# è®¾ç½®æ—¥æœŸ
if [ -n "$1" ]; then
    DATE=$1
else
    DATE=$(date +%Y-%m-%d)
fi

# æ£€æŸ¥æ—¥æœŸæ ¼å¼
if [[ ! $DATE =~ ^[0-9]{4}-[0-9]{2}-[0-9]{2}$ ]]; then
    echo "é”™è¯¯: æ—¥æœŸæ ¼å¼åº”ä¸º YYYY-MM-DD"
    echo "ä¾‹å¦‚: ./create-daily-note.sh 2025-12-10"
    exit 1
fi

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨
NOTE_FILE="/Users/zyhz/KnowledgeBase/daily-notes/${DATE}.md"
if [ -f "$NOTE_FILE" ]; then
    echo "é”™è¯¯: ${DATE} çš„ç¬”è®°å·²å­˜åœ¨"
    echo "æ–‡ä»¶ä½ç½®: $NOTE_FILE"
    echo "æ˜¯å¦è¦æ‰“å¼€çŽ°æœ‰æ–‡ä»¶? (y/n)"
    read -r response
    if [[ "$response" =~ ^[Yy]$ ]]; then
        # æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©æ‰“å¼€æ–¹å¼
        if [[ "$OSTYPE" == "darwin"* ]]; then
            open "$NOTE_FILE"
        elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
            xdg-open "$NOTE_FILE"
        else
            echo "è¯·æ‰‹åŠ¨æ‰“å¼€æ–‡ä»¶: $NOTE_FILE"
        fi
    fi
    exit 0
fi

# èŽ·å–æ˜ŸæœŸå‡ 
DAY_OF_WEEK=$(date -j -f "%Y-%m-%d" "$DATE" "+%A" 2>/dev/null || echo "æ˜ŸæœŸ")

# åˆ›å»ºç›®å½•ï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
mkdir -p "/Users/zyhz/KnowledgeBase/daily-notes"

# å¤åˆ¶æ¨¡æ¿å¹¶æ›¿æ¢å˜é‡
TEMPLATE="/Users/zyhz/KnowledgeBase/templates/daily-note-template.md"

if [ -f "$TEMPLATE" ]; then
    # ä½¿ç”¨æ¨¡æ¿åˆ›å»ºæ–‡ä»¶
    sed -e "s/{{DATE}}/$DATE/g" \
        -e "s/{{DAY_OF_WEEK}}/$DAY_OF_WEEK/g" \
        -e "s/{{TAGS}}/å­¦ä¹ /g" \
        -e "s/{{MOOD}}/å¹³é™/g" \
        -e "s/{{EFFICIENCY}}/7/g" \
        "$TEMPLATE" > "$NOTE_FILE"
else
    # å¦‚æžœæ¨¡æ¿ä¸å­˜åœ¨ï¼Œåˆ›å»ºåŸºæœ¬æ–‡ä»¶
    cat > "$NOTE_FILE" << EOF
# æ¯æ—¥å­¦ä¹ ç¬”è®° - $DATE

## ðŸ“… æ—¥æœŸ
$DATE - $DAY_OF_WEEK

## ðŸŽ¯ ä»Šæ—¥ç›®æ ‡
- [ ] ç›®æ ‡1
- [ ] ç›®æ ‡2
- [ ] ç›®æ ‡3

## ðŸ“š å­¦ä¹ å†…å®¹

### 1. ä¸»é¢˜A
**å…³é”®æ¦‚å¿µ**ï¼š
- æ¦‚å¿µ1ï¼šç®€è¦è¯´æ˜Ž
- æ¦‚å¿µ2ï¼šç®€è¦è¯´æ˜Ž

**é‡è¦å‘çŽ°**ï¼š
- å‘çŽ°1
- å‘çŽ°2

### 2. ä¸»é¢˜B
**å…³é”®æ¦‚å¿µ**ï¼š
- æ¦‚å¿µ1ï¼šç®€è¦è¯´æ˜Ž
- æ¦‚å¿µ2ï¼šç®€è¦è¯´æ˜Ž

## ðŸ’¡ çµæ„Ÿä¸Žæ€è€ƒ
- æƒ³æ³•1
- æƒ³æ³•2
- å¾…æ·±å…¥ç ”ç©¶çš„é—®é¢˜

## ðŸ“ å¾…åŠžäº‹é¡¹
- [ ] æ·±å…¥å­¦ä¹ ä¸»é¢˜Açš„æŸä¸ªæ–¹é¢
- [ ] å®žè·µä¸»é¢˜Bçš„ç›¸å…³æŠ€æœ¯
- [ ] é˜…è¯»ç›¸å…³æ–‡ç« æˆ–æ–‡æ¡£

## ðŸ”— ç›¸å…³èµ„æº
- [èµ„æº1æ ‡é¢˜](é“¾æŽ¥)
- [èµ„æº2æ ‡é¢˜](é“¾æŽ¥)

## ðŸ“Š ä»Šæ—¥æ€»ç»“
ä»Šå¤©ä¸»è¦å­¦ä¹ äº†...ï¼Œæœ€å¤§çš„æ”¶èŽ·æ˜¯...ï¼Œéœ€è¦ç»§ç»­å…³æ³¨çš„æ˜¯...

---
**æ ‡ç­¾**: #æ¯æ—¥å­¦ä¹ 
**å¿ƒæƒ…**: ðŸ˜Š
**æ•ˆçŽ‡**: 7/10
EOF
fi

echo "âœ… æˆåŠŸåˆ›å»ºæ¯æ—¥ç¬”è®°: $NOTE_FILE"

# è¯¢é—®æ˜¯å¦ç«‹å³æ‰“å¼€æ–‡ä»¶
echo "æ˜¯å¦ç«‹å³æ‰“å¼€æ–‡ä»¶è¿›è¡Œç¼–è¾‘? (y/n)"
read -r response
if [[ "$response" =~ ^[Yy]$ ]]; then
    # æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©æ‰“å¼€æ–¹å¼
    if [[ "$OSTYPE" == "darwin"* ]]; then
        open "$NOTE_FILE"
    elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
        xdg-open "$NOTE_FILE"
    else
        echo "è¯·æ‰‹åŠ¨æ‰“å¼€æ–‡ä»¶: $NOTE_FILE"
    fi
fi

echo ""
echo "ðŸ’¡ ä½¿ç”¨æç¤º:"
echo "  - ç¼–è¾‘å®ŒæˆåŽä¿å­˜æ–‡ä»¶"
echo "  - å®šæœŸå›žé¡¾å’Œæ•´ç†ç¬”è®°"
echo "  - å°†é‡è¦å†…å®¹æ•´ç†æˆç‹¬ç«‹çŸ¥è¯†æ¡ç›®"